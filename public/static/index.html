<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>小爬爬少儿美术</title>

    <!-- head 中 -->
    <link rel="stylesheet" href="//cdn.bootcss.com/weui/1.1.1/style/weui.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/jquery-weui/1.0.1/css/jquery-weui.min.css">
    <link rel="stylesheet" href="css/demos.css">

</head>
<body id="app-layout" ontouchstart>

<div class="weui-tab">
    <div class="weui-tab__bd" id="xpp_tab">
        <div id="tab1" class="weui-tab__bd-item weui-tab__bd-item--active">
            <div style="margin-bottom:53px">
                <header class='demos-header'>
                    <h1 class="demos-title">Panel</h1>
                </header>
                <div class="page__bd">
                    <div class="weui-panel weui-panel_access">
                        <div class="weui-panel__hd">图文组合列表</div>
                        <div class="weui-panel__bd" id="xpp_article_list">
                            <div class="weui-loadmore weui-loadmore_line" id="xpp_loadmore_none" style="display:none;">
                                <span class="weui-loadmore__tips">暂无数据</span>
                            </div>
                        </div>
                        <!--<div class="weui-panel__ft">-->
                        <!--<a href="javascript:void(0);" class="weui-cell weui-cell_access weui-cell_link">-->
                        <!--<div class="weui-cell__bd">查看更多</div>-->
                        <!--<span class="weui-cell__ft"></span>-->
                        <!--</a>-->
                        <!--</div>-->
                    </div>
                </div>
                <div class="weui-infinite-scroll">
                    <div class="infinite-preloader">
                        <div class="weui-loadmore" id="xpp_loadmore">
                            <i class="weui-loading"></i>
                            <span class="weui-loadmore__tips">正在加载</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab2" class="weui-tab__bd-item">
            <h1>页面二</h1>
        </div>
        <div id="tab3" class="weui-tab__bd-item">
            <h1>页面三</h1>
        </div>
        <div id="tab4" class="weui-tab__bd-item" style="">
            <header class='demos-header'>
                <h1 class="demos-title">我的</h1>
            </header>

            <div class="weui-cells__title">新消息提示跟摘要信息后，统一在列表右侧</div>
            <div class="weui-cells">
                <a class="weui-cell weui-cell_access" style="color: #151414;text-decoration: none;"
                   href="uploader.html">
                    <div class="weui-cell__bd">
                        发表文章
                        <!--<a class="" href="uploader.html" style="color: #151414;text-decoration: none;">发表文章</a>-->
                    </div>
                </a>
            </div>

            <div class="weui-cells__title">未读数红点跟在主题信息后，统一在列表左侧</div>
            <div class="weui-cells">
                <div class="weui-cell">
                    <div class="weui-cell__hd" style="position: relative;margin-right: 10px;">
                        <img src="images/pic_160.png" style="width: 50px;display: block">
                        <span class="weui-badge" style="position: absolute;top: -.4em;right: -.4em;">8</span>
                    </div>
                    <div class="weui-cell__bd">
                        <p>联系人名称</p>
                        <p style="font-size: 13px;color: #888888;">摘要信息</p>
                    </div>
                </div>
                <div class="weui-cell weui-cell_access">
                    <div class="weui-cell__bd">
                        <span style="vertical-align: middle">单行列表</span>
                        <span class="weui-badge" style="margin-left: 5px;">8</span>
                    </div>
                    <div class="weui-cell__ft"></div>
                </div>
                <div class="weui-cell weui-cell_access">
                    <div class="weui-cell__bd">
                        <span style="vertical-align: middle">单行列表</span>
                        <span class="weui-badge" style="margin-left: 5px;">8</span>
                    </div>
                    <div class="weui-cell__ft">详细信息</div>
                </div>
                <div class="weui-cell weui-cell_access">
                    <div class="weui-cell__bd">
                        <span style="vertical-align: middle">单行列表</span>
                        <span class="weui-badge" style="margin-left: 5px;">New</span>
                    </div>
                    <div class="weui-cell__ft"></div>
                </div>
            </div>
        </div>
    </div>


    <div class="weui-tabbar">
        <a href="#tab1" class="weui-tabbar__item  weui-bar__item--on" id="xpp_tab1">
            <div class="weui-tabbar__icon">
                <img src="./images/icon_nav_article.png" alt="">
            </div>
            <p class="weui-tabbar__label">发现</p>
        </a>
        <a href="javascript:void(0)" class="weui-tabbar__item">
            <div class="weui-tabbar__icon">
                <img src="./images/icon_nav_button.png" alt="">
            </div>
            <p class="weui-tabbar__label">收藏</p>
        </a>
        <a href="javascript:void(0)" class="weui-tabbar__item">
            <div class="weui-tabbar__icon">
                <img src="./images/icon_nav_msg.png" alt="">
            </div>
            <p class="weui-tabbar__label">通讯录</p>
        </a>
        <a href="#tab4" class="weui-tabbar__item" id="xpp_me">
            <div class="weui-tabbar__icon">
                <img src="./images/icon_nav_cell.png" alt="">
            </div>
            <p class="weui-tabbar__label">我</p>
        </a>
    </div>
</div>


<!-- body 最后 -->
<script src="//cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>
<script>
    $(function () {
        FastClick.attach(document.body);
    });
</script>
<script src="//cdn.bootcss.com/jquery-weui/1.0.1/js/jquery-weui.min.js"></script>

<!-- 如果使用了某些拓展插件还需要额外的JS -->
<script src="//cdn.bootcss.com/jquery-weui/1.0.1/js/swiper.min.js"></script>
<script src="//cdn.bootcss.com/jquery-weui/1.0.1/js/city-picker.min.js"></script>
<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js"></script>
<script src="js/formExt.js"></script>
<script>
    function initTab1(page) {
        var url = '/article?page='+page;
        ajaxExt.get(url, function (result) {

            console.log("请求成功，JSON解析后的响应数据为:", result);
            var data = result.data;
            if (data.length == 0) {
                $('#tab1').destroyInfinite()
                $('#xpp_loadmore').attr('style', 'display:none;');
                return false;
            }
            for (var i = 0; i < data.length; i++) {
                var html =
                    '<a href="' + data[i]['a_href'] + '" class="weui-media-box weui-media-box_appmsg">' +
                    '<div class="weui-media-box__hd">' +
                    '<img class="weui-media-box__thumb" src="' + data[i]['thumb'] + '" alt="">' +
                    '</div>' +
                    '<div class="weui-media-box__bd">' +
                    '<h4 class="weui-media-box__title">' + data[i]['title'] + '</h4>' +
                    '<p class="weui-media-box__desc">' + data[i]['description'] + '</p>' +
                    '<ul class="weui-media-box__info">' +
                    '<li class="weui-media-box__info__meta">文字来源</li>' +
                    '<li class="weui-media-box__info__meta">时间</li>' +
                    '<li class="weui-media-box__info__meta weui-media-box__info__meta_extra">其它信息</li>' +
                    '</ul>' +
                    '</div>' +
                    ' </a>';
                $('#xpp_article_list').append(html);
            }
        });
    }

    function initTab4(id) {
        if (AuthExt.check()) {
            $('.weui-tabbar__item').removeClass('weui-bar__item--on');
            $('a[href=' + id + ']').addClass('weui-bar__item--on');
            $('#tab1').removeClass('weui-tab__bd-item--active');
            $('#tab2').removeClass('weui-tab__bd-item--active');
            $('#tab3').removeClass('weui-tab__bd-item--active');
            $('#tab4').addClass('weui-tab__bd-item--active').attr('style', '');
            
        }else {
            $('.weui-tabbar__item').removeClass('weui-bar__item--on');
            $('a[href=' + id + ']').addClass('weui-bar__item--on');
            $('#tab1').removeClass('weui-tab__bd-item--active');
            $('#tab2').removeClass('weui-tab__bd-item--active');
            $('#tab3').removeClass('weui-tab__bd-item--active');
            $('#tab4').addClass('weui-tab__bd-item--active').attr('style', '');
        }
    }

    $(function () {
        var page = 1;
        //滚动加载
        var loading = false;  //状态标记
        $('#tab1').infinite().on("infinite", function() {
            if(loading) return;
            loading = true;
            page = page + 1;
            setTimeout(function() {
                initTab1(page);
                loading = false;
            }, 200);   //模拟延迟
        });

        $('#xpp_me').click(function(){
            if(AuthExt.check()){
                $('#tab4').attr('style', '');
            }
        });
        $('#xpp_tab1').click(function () {
            console.log($('#xpp_loadmore').attr('style'))
            if($('#xpp_loadmore').attr('style') == undefined){
                initTab1();
            }
        })
        $('.weui-tabbar__item').click(function () {
            location.hash = $(this).attr('href');
        })
        if (location.hash != undefined || location.hash != '') {
            var id = location.hash;
            console.log('id', id);
            switch (id) {
//               case '#tab1':
//                   break;
                case '#tab4':
                    initTab4(id);
                    break;
                default :
                    initTab1();
                    location.hash = ''
                    break;
            }
        }
    })
</script>
</body>
</html>
